<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>倒计时</title>
	<style type="text/css">
		*{padding: 0;margin:0;}
		html{
			height: 100%;
		}
		body{
			height: 100%;
			overflow: hidden;
		}
		#camvas{
			/*margin-top: 100px;*/
			height: 100%;
		}

	</style>

	<script type="text/javascript" src="digit.js"></script>
</head>
<body>
	
	<canvas id="canvas"></canvas>


<script type="text/javascript">
	
	var WINDOW_WIDTH = 1024;
	var WINDOW_HEIGHT = 768;

	var RADIUS = 7.5 ;
	var colors = ["#33b5e5","#0099cc","#aa66cc","#9933cc","#99cc00","669900","#ffbb33","#ff800","#ff444","#cc0000"];
	var balls = new Array;

	var newh = "";
	var newm = "";
	var news = "";
	var oldh = "-1";
	var oldm = "-1";
	var olds = "-1";

	WINDOW_WIDTH = document.body.clientWidth;
	WINDOW_HEIGHT = document.body.clientHeight;

	var canvas = document.getElementById("canvas");
	var cantext = canvas.getContext("2d");

	canvas.width = WINDOW_WIDTH;
	canvas.height = WINDOW_HEIGHT;


	setInterval(function () {
		rander(cantext);
		update(cantext);
	}, 50);


	// 处理时间
	function rander (cxt) {
		console.log(balls.length);
		cxt.clearRect(0, 0, WINDOW_WIDTH, WINDOW_HEIGHT);
		var time = new Date();
		newh = time.getHours();
		newm = time.getMinutes();
		news = time.getSeconds();

		renderDigit( 0 , 0 , parseInt(newh/10) , cxt );
		renderDigit( 8*(RADIUS+1)*2 , 0 , parseInt(newh%10) , cxt );
		renderDigit( 17*(RADIUS+1)*2 , 0 , parseInt(10) , cxt );
		renderDigit( 22*(RADIUS+1)*2 , 0 , parseInt(newm/10) , cxt );
		renderDigit( 30*(RADIUS+1)*2 , 0 , parseInt(newm%10) , cxt );
		renderDigit( 38*(RADIUS+1)*2 , 0 , parseInt(10) , cxt );
		renderDigit( 43*(RADIUS+1)*2 , 0 , parseInt(news/10) , cxt);
		renderDigit( 51*(RADIUS+1)*2 , 0 , parseInt(news%10) , cxt);

	}

	// 绘制数字
	function renderDigit ( x , y , num , cxt ) {

		cxt.fillStyle = "#FF9619";
		for( var i = 0 ; i < digit[num].length ; i ++ )
			for(var j = 0 ; j < digit[num][i].length ; j ++)
				if(digit[num][i][j] == 1){
					cxt.beginPath();
					cxt.arc(x+j*2*(RADIUS+1)+(RADIUS+1),y+i*2*(RADIUS+1)+(RADIUS+1),RADIUS,0,2*Math.PI);

					cxt.closePath();
					cxt.fill();

				}
		
	}

	// 彩虹点
	function update (cxt) {
		
		if(oldh/10!=newh/10){
			addBalls( 0 , 0 , parseInt(newh/10) );
		}
		if(oldh%10!=newh%10){
			addBalls( 8*(RADIUS+1)*2 , 0 , parseInt(newh%10) );
		}
		if(oldm/10!=newm/10){
			addBalls( 22*(RADIUS+1)*2 , 0 , parseInt(newm/10));
		}
		if(oldm%10!=newm%10){
			addBalls( 30*(RADIUS+1)*2 , 0 , parseInt(newm%10));
		}
		if(parseInt(olds/10)!=parseInt(news/10)){
			addBalls( 43*(RADIUS+1)*2 , 0 , parseInt(news/10));
		}
		if(olds%10!=news%10){
			addBalls( 51*(RADIUS+1)*2 , 0 , parseInt(news%10) );

		}
		olds = news;
		oldm = newm;
		oldh = newh;
		
		updateBalls(cxt);

	}

	function addBalls ( x , y , num) {

		for( var i = 0 ; i < digit[num].length ; i ++ )
			for(var j = 0 ; j < digit[num][i].length ; j ++)
				if(digit[num][i][j] == 1){
					var aBall = {
						x:x+j*2*(RADIUS+1)+(RADIUS+1),
						y:y+i*2*(RADIUS+1)+(RADIUS+1),
						color:colors[parseInt(Math.random()*colors.length)] ,
						g:1.5+Math.random(),
	                    vx:Math.pow( -1 , Math.ceil( Math.random()*1000 ) ) * 4,
	                    vy:-5
					}
					balls.push(aBall);
				}
	}

	function updateBalls (cxt) {

		for(var i = 0 ; i < balls.length ; i ++){

			//移动
			balls[i].x += balls[i].vx;
			balls[i].y += balls[i].vy;
			balls[i].vy += balls[i].g;

			if(balls[i].y >= WINDOW_HEIGHT - RADIUS){
				balls[i].y = WINDOW_HEIGHT - RADIUS;
				balls[i].vy = -balls[i].vy*0.7;
			}

			//绘制
			cxt.beginPath();
			cxt.fillStyle = balls[i].color;
			cxt.arc(balls[i].x,balls[i].y,RADIUS,0,2*Math.PI);
			cxt.closePath();
			cxt.fill();
		
			if(balls[i].x > WINDOW_WIDTH || balls[i].x < 0){
				balls.splice(i,1);
			}

		}
		
	}







</script>
	
	
</body>
</html>